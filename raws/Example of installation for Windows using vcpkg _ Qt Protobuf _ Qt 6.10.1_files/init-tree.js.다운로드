function findNodeByHref(tree, targetHref) {
    if (tree.a_attr && tree.a_attr.href === targetHref) {
        return tree;
    }
    if (tree.children) {
        for (let child of tree.children) {
            let result = findNodeByHref(child, targetHref);
            if (result)
                return result;
        }
    }
    return null;
}

window.addEventListener('load', function() {
    $.getJSON("./toc-tree.json", function( data ) {
        const doc = window.location.pathname.split('/').pop();
        if (doc) {
            var node = findNodeByHref(data.node, doc);
            if (node) node.state = { selected: true, opened: true };
        }
        const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'default-dark' : 'default';

        $('#sidebar-toctree').jstree({
            'core' : {
                "multiple" : false,
                "themes" : {
                    "name": theme,
                    "dots" : false,
                    "icons" : false
                },
                "data": data.node.children,
                "force_text" : true
            }
        });

        $('#sidebar-toctree').on('select_node.jstree', function(event, data) {
            window.open(data.node.original.a_attr.href, "_self");
        });
    });

    $('#sidebar-toctree').on('ready.jstree', function(event, data) {
        if ($('.jstree-clicked').length > 0) {
            var sidebar = $('.b-sidebar__sidebar');
            sidebar.animate({scrollTop: $('.jstree-clicked').first().offset().top-sidebar.offset().top},0);
        }
    });
}, false);
